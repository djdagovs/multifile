/* jquery-multifile v2.2.1 @ 2015-11-20 05:11:15 */window.jQuery&&function(a){"use strict";function b(a){return a>1048576?(a/1048576).toFixed(1)+"Mb":1024==a?"1Mb":(a/1024).toFixed(1)+"Kb"}function c(a){return(a.files&&a.files.length?a.files:null)||[{name:a.value,size:0,type:((a.value||"").match(/[^\.]+$/i)||[""])[0]}]}a.fn.MultiFile=function(d){if(!this.length)return this;if("string"==typeof arguments[0]){if(this.length>1){var e=arguments;return this.each(function(){a.fn.MultiFile.apply(a(this),e)})}return a.fn.MultiFile[arguments[0]].apply(this,a.makeArray(arguments).slice(1)||[])}"number"==typeof d&&(d={max:d});var d=a.extend({},a.fn.MultiFile.options,d||{});a("form").not("MultiFile-intercepted").addClass(d.multifileName+"-intercepted").submit(a.fn.MultiFile.disableEmpty),a.fn.MultiFile.options.autoIntercept&&(a.fn.MultiFile.intercept(a.fn.MultiFile.options.autoIntercept),a.fn.MultiFile.options.autoIntercept=null),this.not("."+d.multifileName).addClass(d.multifileName).each(function(){window.MultiFile=(window.MultiFile||0)+1;var e=window.MultiFile,f={e:this,E:a(this),clone:a(this).clone()},g=a.extend({},a.fn.MultiFile.options,d||{},(a.metadata?f.E.metadata():a.meta?f.E.data():null)||{},{});g.max>0||(g.max=f.E.attr("maxlength")),g.max>0||(g.max=(String(f.e.className.match(/\b(max|limit)\-([0-9]+)\b/gi)||[""]).match(/[0-9]+/gi)||[""])[0],g.max>0?g.max=String(g.max).match(/[0-9]+/gi)[0]:g.max=-1),g.max=new Number(g.max),g.accept=g.accept||f.E.attr("accept")||"",g.accept||(g.accept=f.e.className.match(/\b(accept\-[\w\|]+)\b/gi)||"",g.accept=new String(g.accept).replace(/^(accept|ext)\-/i,"")),g.maxsize=g.maxsize>0?g.maxsize:f.E.data("maxsize")||0,g.maxsize>0||(g.maxsize=(String(f.e.className.match(/\b(maxsize|maxload|size)\-([0-9]+)\b/gi)||[""]).match(/[0-9]+/gi)||[""])[0],g.maxsize>0?g.maxsize=String(g.maxsize).match(/[0-9]+/gi)[0]:g.maxsize=-1),g.maxfile=g.maxfile>0?g.maxfile:f.E.data("maxfile")||0,g.maxfile>0||(g.maxfile=(String(f.e.className.match(/\b(maxfile|filemax)\-([0-9]+)\b/gi)||[""]).match(/[0-9]+/gi)||[""])[0],g.maxfile>0?g.maxfile=String(g.maxfile).match(/[0-9]+/gi)[0]:g.maxfile=-1),g.maxfile>1&&(g.maxfile=1024*g.maxfile),g.maxsize>1&&(g.maxsize=1024*g.maxsize),g.max>1&&f.E.attr("multiple","multiple").prop("multiple",!0),a.extend(f,g||{}),f.STRING=a.extend(f.STRING||{},a.fn.MultiFile.options.STRING,f.STRING),a.extend(f,{n:0,slaves:[],files:[],instanceKey:f.e.id||d.multifileName+String(e),generateID:function(a){return f.instanceKey+(a>0?"_F"+String(a):"")},trigger:function(b,d,e,f){var g,h=e[b]||e["on"+b];return h?(f=f||e.files||c(this),a.each(f,function(a,b){g=h.apply(e.wrapper,[d,b.name,e,b])}),g):void 0}}),String(f.accept).length>1&&(f.accept=f.accept.replace(/\W+/g,"|").replace(/^\W|\W$/g,""),f.rxAccept=new RegExp("\\.("+(f.accept?f.accept:"")+")$","gi")),f.wrapID=f.instanceKey+"-wrap",d.buttonInWrap?f.E.next(d.buttonInWrap).andSelf().wrapAll('<div class="'+d.multifileName+'-wrap" id="'+f.wrapID+'"></div>'):f.E.wrap('<div class="'+d.multifileName+'-wrap" id="'+f.wrapID+'"></div>'),f.wrapper=a("#"+f.wrapID),f.e.name=f.e.name||"file"+e+"[]",f.list||(a('<div class="'+d.multifileName+'-list" id="'+f.wrapID+'-list"></div>').insertBefore(f.wrapper),f.list=a("#"+f.wrapID+"-list")),f.list=a(f.list),f.addSlave=function(g,h){f.n++,g.MultiFile=f,g.id=g.name="",g.multiple=f.clone.context.multiple,g.id=f.generateID(h),g.name=String(f.namePattern.replace(/\$name/gi,a(f.clone).attr("name")).replace(/\$id/gi,a(f.clone).attr("id")).replace(/\$g/gi,e).replace(/\$i/gi,h));var i;f.max>0&&f.files.length>f.max&&(g.disabled=!0,i=!0),f.current=g,g=a(g),g.val("").attr("value","")[0].value="",g.addClass(d.multifileName+"-applied"),g.change(function(e,i,j){a(this).blur();var k=this,l=f.files||[],m=this.files||[{name:this.value,size:0,type:((this.value||"").match(/[^\.]+$/i)||[""])[0]}],n=[],o=0,p=f.total_size||0,q=(this.files&&a(this).attr("multiple"),[]);a.each(m,function(a,b){n[n.length]=b}),f.trigger("FileSelect",this,f,n),a.each(m,function(d,e){var g=e.name,h=e.size,i=function(a){return a.replace("$ext",String(g.match(/[^\.]+$/i)||"")).replace("$file",g.match(/[^\/\\]+$/gi)).replace("$size",b(h)+" > "+b(f.maxfile))};f.accept&&g&&!g.match(f.rxAccept)&&(q[q.length]=i(f.STRING.denied),f.trigger("FileInvalid",this,f,[e])),a(f.wrapper).find("input[type=file]").not(k).each(function(){a.each(c(this),function(a,b){if(b.name){var c=(b.name||"").replace(/^C:\\fakepath\\/gi,"");(g==c||g==c.substr(c.length-g.length))&&(q[q.length]=i(f.STRING.duplicate),f.trigger("FileDuplicate",k,f,[b]))}})}),f.maxfile>0&&h>0&&h>f.maxfile&&(q[q.length]=i(f.STRING.toobig),f.trigger("FileTooBig",this,f,[e])),f.minfile>0&&h>0&&h<f.minfile&&(q[q.length]=i(f.STRING.toosmall),f.trigger("FileTooSmall",this,f,[e]));var j=f.trigger("FileValidate",this,f,[e]);j&&""!==j&&(q[q.length]=i(j)),o+=e.size}),p+=o,n.size=o,n.total=p,n.total_length=n.length+l.length,f.max>0&&l.length+m.length>f.max&&(q[q.length]=f.STRING.toomany.replace("$max",f.max),f.trigger("FileTooMany",this,f,n)),f.min>0&&l.length+m.length<f.min&&(q[q.length]=f.STRING.toofew.replace("$min",f.min),f.trigger("FileTooFew",this,f,n)),f.maxsize>0&&p>f.maxsize&&(q[q.length]=f.STRING.toomuch.replace("$size",b(p)+" > "+b(f.maxsize)),f.trigger("FileTooMuch",this,f,n)),f.minsize>0&&p<f.minsize&&(q[q.length]=f.STRING.toolittle.replace("$size",b(p)+" < "+b(f.minsize)),f.trigger("FileTooLittle",this,f,n));var r=a(f.clone).clone();return r.addClass(d.multifileName),q.length>0?("function"==a.type(f.error)&&f.error(q.join("\n\n")),f.n--,f.addSlave(r[0],h),g.parent().prepend(r),g.remove(),!1):(f.total_size=p,m=l.concat(n),m.size=p,m.size_label=b(p),f.files=m,a(this).css({position:"absolute",top:"-3000px"}),g.after(r),f.addSlave(r[0],h+1),f.addToList(this,h,n),f.trigger("afterFileSelect",this,f,n),void 0)}),a(g).data("multifileName",d.multifileName),a(g).data(d.multifileName+"-wrap",f.wrapper),a(f.wrapper).data("MultiFile",f),i&&a(g).attr("disabled","disabled").prop("disabled",!0)},f.addToList=function(e,g,h){f.trigger("FileAppend",e,f,h);var i=a("<span/>");a.each(h,function(c,g){var h=String(g.name||""),j=f.STRING,k=j.label||j.file||j.name,l=j.title||j.tooltip||j.selected,m='<img class="'+d.multifileName+'-preview" style="'+f.previewCss+'"/>',n=a(('<span class="'+d.multifileName+'-label" title="'+l+'"><span class="'+d.multifileName+'-title">'+k+"</span>"+(f.preview||a(e).is(".with-preview")?m:"")+"</span>").replace(/\$(file|name)/gi,(h.match(/[^\/\\]+$/gi)||[h])[0]).replace(/\$(ext|extension|type)/gi,(h.match(/[^\.]+$/gi)||[""])[0]).replace(/\$(size)/gi,b(g.size||0)).replace(/\$(preview)/gi,m));n.find("img."+d.multifileName+"-preview").each(function(){var a=this,b=new FileReader;b.readAsDataURL(g),b.onload=function(b){a.src=b.target.result}}),c>1&&i.append(", "),i.append(n)});var j=a('<div class="'+d.multifileName+'-label"></div>'),k=a('<a class="'+d.multifileName+'-remove" href="#'+f.wrapID+'">'+f.STRING.remove+"</a>").click(function(){var d=c(e);f.trigger("FileRemove",e,f,d),f.n--,f.current.disabled=!1,a(e).remove(),a(this).parent().remove(),a(f.current).css({position:"",top:""}),a(f.current).reset().val("").attr("value","")[0].value="";var g=[],h=0;return a(f.wrapper).find("input[type=file]").each(function(){a.each(c(this),function(a,b){b.name&&(g[g.length]=b,h+=b.size)})}),f.files=g,f.total_size=h,f.size_label=b(h),a(f.wrapper).data("MultiFile",f),f.trigger("afterFileRemove",e,f,d),f.trigger("FileChange",f.current,f,g),!1});f.list.append(j.append(k," ",i)),f.trigger("afterFileAppend",e,f,h),f.trigger("FileChange",e,f,f.files)},f.MultiFile||f.addSlave(f.e,0),f.n++})},a.extend(a.fn.MultiFile,{data:function(){var b=a(this),c=b.is("."+this.data("multifileName")+"-wrap"),d=c?b:b.data(this.data("multifileName")+"-wrap");if(console.log("$.extend",d),!d||!d.length)return!console.error("Could not find MultiFile control wrapper");var e=d.data("MultiFile");return e?e||{}:!console.error("Could not find MultiFile data in wrapper")},reset:function(){var b=this.MultiFile("data");return b&&a(b.list).find("."+b.multifileName+"-remove").click(),a(this)},files:function(){var a=this.MultiFile("data");return a?a.files||[]:!console.log("MultiFile plugin not initialized")},size:function(){var a=this.MultiFile("data");return a?a.total_size||0:!console.log("MultiFile plugin not initialized")},count:function(){var a=this.MultiFile("data");return a?a.files?a.files.length||0:0:!console.log("MultiFile plugin not initialized")},disableEmpty:function(b){b=("string"==typeof b?b:"")||"mfD";var c=[];return a("input:file.MultiFile").each(function(){""==a(this).val()&&(c[c.length]=this)}),window.clearTimeout(a.fn.MultiFile.reEnableTimeout),a.fn.MultiFile.reEnableTimeout=window.setTimeout(a.fn.MultiFile.reEnableEmpty,500),a(c).each(function(){this.disabled=!0}).addClass(b)},reEnableEmpty:function(b){return b=("string"==typeof b?b:"")||"mfD",a("input:file."+b).removeClass(b).each(function(){this.disabled=!1})},intercepted:{},intercept:function(b,c,d){var e,f;if(d=d||[],d.constructor.toString().indexOf("Array")<0&&(d=[d]),"function"==typeof b)return a.fn.MultiFile.disableEmpty(),f=b.apply(c||window,d),setTimeout(function(){a.fn.MultiFile.reEnableEmpty()},1e3),f;b.constructor.toString().indexOf("Array")<0&&(b=[b]);for(var g=0;g<b.length;g++)e=b[g]+"",e&&function(b){a.fn.MultiFile.intercepted[b]=a.fn[b]||function(){},a.fn[b]=function(){return a.fn.MultiFile.disableEmpty(),f=a.fn.MultiFile.intercepted[b].apply(this,arguments),setTimeout(function(){a.fn.MultiFile.reEnableEmpty()},1e3),f}}(e)}}),a.fn.MultiFile.options={accept:"",max:-1,maxfile:-1,maxsize:-1,minfile:-1,minsize:-1,namePattern:"$name",preview:!1,previewCss:"max-height:100px; max-width:100px;",multifileName:"MultiFile",buttonInWrap:"",STRING:{remove:"x",denied:"You cannot select a $ext file.\nTry again...",file:"$file",selected:"File selected: $file",duplicate:"This file has already been selected:\n$file",toomuch:"The files selected exceed the maximum size permited ($size)",toolittle:"The files do not reach the minimum size required ($size)",toomany:"Too many files selected (max: $max)",toofew:"Too few files selected (min: $max)",toobig:"$file is too big (max $size)",toosmall:"$file is too small (min $size)"},autoIntercept:["submit","ajaxSubmit","ajaxForm","validate","valid"],error:function(a){"undefined"!=typeof console&&console.log(a),alert(a)}},a.fn.reset=a.fn.reset||function(){return this.each(function(){try{this.reset()}catch(a){}})},a(function(){a("input[type=file].multi").MultiFile()})}(jQuery);